{% comment %}
  ============================================================================
  Section: Custom Banner (Announcement Bar)
  ============================================================================
{% endcomment %}

{{ 'custom-sections.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign section_width = section.settings.section_width | default: 'full-width'
  assign btn_bg = section.settings.button_bg_color | default: '#E8D44D'
  assign btn_text = section.settings.button_text_color | default: '#000000'
  assign btn_hover_bg = section.settings.button_hover_bg_color | default: '#d4c043'
  assign btn_hover_text = section.settings.button_hover_text_color | default: '#000000'
  assign btn_border_color = section.settings.button_border_color | default: '#E8D44D'
-%}

{%- comment -%} Scoped styles: dynamic customizer values applied per section instance {%- endcomment -%}
<style>
  #CustomBanner-{{ section.id }} {
    --cb-btn-bg: {{ btn_bg }};
    --cb-btn-text: {{ btn_text }};
    --cb-btn-hover-bg: {{ btn_hover_bg }};
    --cb-btn-hover-text: {{ btn_hover_text }};
    --cb-btn-border: {{ btn_border_color }};
  }
</style>

{%- comment -%} Background layer — required by Horizon theme (base.css forces .section to transparent) {%- endcomment -%}
<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<section
  id="CustomBanner-{{ section.id }}"
  class="cb section section--{{ section_width }} color-{{ section.settings.color_scheme }} spacing-style"
  style="{% render 'spacing-padding', settings: section.settings %}"
  data-section-id="{{ section.id }}"
  data-section-type="custom-banner"
  role="banner"
>
  {%- comment -%} ===== DESKTOP BAR ===== {%- endcomment -%}
  <div class="cb__bar">

    {%- comment -%} Left: Logo (image or text) — links to home page {%- endcomment -%}
    <a class="cb__logo" href="{{ routes.root_url }}" aria-label="{{ shop.name }}">
      {%- if section.settings.logo_image != blank -%}
        <img
          class="cb__logo-img"
          src="{{ section.settings.logo_image | image_url: width: 200 }}"
          alt="{{ section.settings.logo_text | default: shop.name | escape }}"
          width="auto"
          height="{{ section.settings.logo_height | default: 20 }}"
          loading="eager"
        >
      {%- else -%}
        <span class="cb__logo-text">{{ section.settings.logo_text | default: shop.name }}</span>
      {%- endif -%}
    </a>

    {%- comment -%} Center: Promotional text (hidden on mobile) {%- endcomment -%}
    {%- if section.settings.promo_text != blank -%}
      <p class="cb__promo-text">{{ section.settings.promo_text }}</p>
    {%- endif -%}

    {%- comment -%} Right: CTA button with arrow (hidden on mobile) {%- endcomment -%}
    {%- if section.settings.button_text != blank -%}
      <a
        href="{{ section.settings.button_link }}"
        class="cb__btn"
        aria-label="{{ section.settings.button_text | escape }}"
      >
        <span class="cb__btn-text">{{ section.settings.button_text }}</span>
        <span class="cb__btn-arrow" aria-hidden="true">&rarr;</span>
      </a>
    {%- endif -%}

    {%- comment -%} Mobile toggle button: hamburger / close {%- endcomment -%}
    <button
      class="cb__toggle"
      type="button"
      aria-label="Toggle banner panel"
      aria-expanded="false"
      data-cb-toggle="{{ section.id }}"
    >
      {%- comment -%} Hamburger icon (3 lines) {%- endcomment -%}
      <svg class="cb__toggle-open" width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <line y1="1" x2="20" y2="1" stroke="currentColor" stroke-width="2"/>
        <line y1="7" x2="20" y2="7" stroke="currentColor" stroke-width="2"/>
        <line y1="13" x2="20" y2="13" stroke="currentColor" stroke-width="2"/>
      </svg>
      {%- comment -%} Close icon (X) {%- endcomment -%}
      <svg class="cb__toggle-close" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <line x1="1.41" y1="1" x2="15" y2="14.59" stroke="currentColor" stroke-width="2"/>
        <line x1="1" y1="14.59" x2="14.59" y2="1" stroke="currentColor" stroke-width="2"/>
      </svg>
    </button>
  </div>

  {%- comment -%} ===== MOBILE PANEL (slide down — no logo, just text + button) ===== {%- endcomment -%}
  <div
    class="cb__panel"
    id="CustomBannerPanel-{{ section.id }}"
    aria-hidden="true"
  >
    {%- comment -%} Promo text in panel {%- endcomment -%}
    {%- if section.settings.promo_text != blank -%}
      <p class="cb__panel-promo">{{ section.settings.promo_text }}</p>
    {%- endif -%}

    {%- comment -%} CTA button in panel {%- endcomment -%}
    {%- if section.settings.button_text != blank -%}
      <a
        href="{{ section.settings.button_link }}"
        class="cb__panel-btn"
        aria-label="{{ section.settings.button_text | escape }}"
      >
        <span class="cb__btn-text">{{ section.settings.button_text }}</span>
        <span class="cb__btn-arrow" aria-hidden="true">&rarr;</span>
      </a>
    {%- endif -%}
  </div>
</section>

{%- comment -%}
  ============================================================================
  Vanilla JavaScript — Mobile Panel Toggle
  ============================================================================
  Handles the hamburger/close toggle on mobile to expand/collapse the panel.
  No jQuery. Uses data attributes scoped to section ID for multi-instance support.
  ============================================================================
{%- endcomment -%}
<script>
  (function() {
    'use strict';

    var sectionId = '{{ section.id }}';
    var toggleBtn = document.querySelector('[data-cb-toggle="' + sectionId + '"]');
    var panel = document.getElementById('CustomBannerPanel-' + sectionId);
    var sectionEl = document.getElementById('CustomBanner-' + sectionId);

    if (!toggleBtn || !panel) return;

    /**
     * Toggle the mobile panel open/closed.
     * Updates aria attributes and CSS class for animation.
     */
    toggleBtn.addEventListener('click', function() {
      var isOpen = sectionEl.classList.contains('cb--panel-open');

      if (isOpen) {
        /* Close the panel */
        sectionEl.classList.remove('cb--panel-open');
        panel.setAttribute('aria-hidden', 'true');
        toggleBtn.setAttribute('aria-expanded', 'false');
      } else {
        /* Open the panel */
        sectionEl.classList.add('cb--panel-open');
        panel.setAttribute('aria-hidden', 'false');
        toggleBtn.setAttribute('aria-expanded', 'true');
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Custom Banner",
  "tag": "section",
  "class": "custom-banner-section",
  "settings": [
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.section_width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 12
    },
    {
      "type": "header",
      "content": "t:content.logo"
    },
    {
      "type": "image_picker",
      "id": "logo_image",
      "label": "t:settings.image",
      "info": "Upload a logo image. If empty, logo text will be used instead."
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "t:settings.heading",
      "default": "TISSO VISON"
    },
    {
      "type": "range",
      "id": "logo_height",
      "min": 12,
      "max": 60,
      "step": 2,
      "default": 20,
      "label": "t:settings.height",
      "unit": "px"
    },
    {
      "type": "header",
      "content": "t:content.text"
    },
    {
      "type": "text",
      "id": "promo_text",
      "label": "t:settings.content",
      "default": "Find the ideal gift for your loved ones."
    },
    {
      "type": "header",
      "content": "t:content.buttons"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "t:settings.label",
      "default": "CHOOSE GIFT"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:settings.link"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "t:settings.color",
      "default": "#E8D44D"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "t:options.button",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_hover_bg_color",
      "label": "t:settings.hover_background",
      "default": "#d4c043"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "t:settings.hover_text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_border_color",
      "label": "t:names.borders",
      "default": "#E8D44D"
    }
  ],
  "presets": [
    {
      "name": "Custom Banner"
    }
  ]
}
{% endschema %}
