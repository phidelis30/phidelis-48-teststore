{{ 'custom-sections.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign section_width = section.settings.section_width | default: 'full-width'
  assign columns = section.settings.columns | default: 3
  assign columns_mobile = section.settings.columns_mobile | default: 2
  assign heading_size = section.settings.heading_size | default: 20
  assign heading_alignment = section.settings.heading_alignment | default: 'left'
  assign products_to_show = section.settings.products_to_show | default: 6
  assign show_title = section.settings.show_card_title
  assign show_price = section.settings.show_card_price
  assign show_description = section.settings.show_card_description
  assign card_click_action = section.settings.card_click_action | default: 'popup'
  assign button_text = section.settings.button_text | default: 'ADD TO CART'
  assign grid_parent_id = 'ProductGrid-' | append: section.id
-%}

<style>
  #ProductGrid-{{ section.id }} {
    --cpg-columns: {{ columns }};
    --cpg-columns-mobile: {{ columns_mobile }};
    --cpg-heading-size: {{ heading_size }}px;
    --cpg-heading-align: {{ heading_alignment }};
    --padding-block-start: {{ section.settings.padding-block-start | default: 60 }}px;
    --padding-block-end: {{ section.settings.padding-block-end | default: 60 }}px;
    --padding-inline-start: {{ section.settings.padding-inline-start | default: 0 }}px;
    --padding-inline-end: {{ section.settings.padding-inline-end | default: 0 }}px;
  }

  #ProductGrid-{{ section.id }} .custom-product-grid__grid > .custom-product-grid__card:nth-child(n + {{ products_to_show | plus: 1 }}) {
    display: none;
  }

  @media screen and (max-width: 749px) {
    #ProductGrid-{{ section.id }} {
      --padding-block-start: {{ section.settings.mobile-padding-block-start | default: 40 }}px;
      --padding-block-end: {{ section.settings.mobile-padding-block-end | default: 40 }}px;
      --padding-inline-start: {{ section.settings.mobile-padding-inline-start | default: 0 }}px;
      --padding-inline-end: {{ section.settings.mobile-padding-inline-end | default: 0 }}px;
    }
  }
</style>

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<section
  id="ProductGrid-{{ section.id }}"
  class="custom-product-grid section section--{{ section_width }} color-{{ section.settings.color_scheme }} spacing-style{% if show_title %} custom-product-grid--show-title{% endif %}{% if show_price %} custom-product-grid--show-price{% endif %}{% if show_description %} custom-product-grid--show-description{% endif %}"
  data-section-id="{{ section.id }}"
  data-section-type="custom-product-grid"
  data-card-click-action="{{ card_click_action }}"
  data-button-text="{{ button_text | escape }}"
>
  {%- if section.settings.heading != blank -%}
    <h2 class="custom-product-grid__heading">{{ section.settings.heading }}</h2>
  {%- endif -%}

  <div class="custom-product-grid__grid">
    {%- content_for 'blocks' -%}
  </div>

  {% render 'custom-product-popup',
    section_id: section.id,
    parent_id: grid_parent_id,
    card_click_action: card_click_action,
    button_text: button_text
  %}
</section>

{% schema %}
{
  "name": "Custom Product Grid",
  "tag": "section",
  "class": "custom-product-grid-section",
  "settings": [
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.section_width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "default": "full-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:settings.columns"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "t:settings.columns",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "t:settings.mobile_columns",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "t:settings.products_per_page",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "header",
      "content": "Card display"
    },
    {
      "type": "checkbox",
      "id": "show_card_title",
      "label": "Show title",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_card_price",
      "label": "Show price",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_card_description",
      "label": "Show description",
      "default": false
    },
    {
      "type": "header",
      "content": "Card action"
    },
    {
      "type": "select",
      "id": "card_click_action",
      "label": "Click action",
      "options": [
        {
          "value": "popup",
          "label": "View popup"
        },
        {
          "value": "product_page",
          "label": "View product detail"
        },
        {
          "value": "add_to_cart",
          "label": "Add to cart"
        }
      ],
      "default": "popup"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text",
      "default": "ADD TO CART"
    },
    {
      "type": "header",
      "content": "t:content.text"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:settings.heading",
      "default": "Featured Products"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "t:settings.alignment",
      "options": [
        {
          "value": "left",
          "label": "t:options.left"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "right",
          "label": "t:options.right"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "t:content.heading_size",
      "min": 14,
      "max": 48,
      "step": 1,
      "unit": "px",
      "default": 20
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "Mobile padding"
    },
    {
      "type": "range",
      "id": "mobile-padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "mobile-padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "mobile-padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "mobile-padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "custom-product-card"
    }
  ],
  "presets": [
    {
      "name": "Custom Product Grid",
      "blocks": [
        { "type": "custom-product-card" },
        { "type": "custom-product-card" },
        { "type": "custom-product-card" },
        { "type": "custom-product-card" },
        { "type": "custom-product-card" },
        { "type": "custom-product-card" }
      ]
    }
  ]
}
{% endschema %}
